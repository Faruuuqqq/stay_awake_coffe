<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Register Page</title>
    <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="/assets/img/favicon.png" rel="icon">
  <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/assets/vendor/drift-zoom/drift-basic.css" rel="stylesheet">

  <!-- Main CSS File -->
<link href="/assets/css/main.css" rel="stylesheet">
</head>
  <%- include('partials/header') %>

  <main class="main">
    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Login</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="current">Login</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Login Register Section -->
    <section id="login-register" class="login-register section">
      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row justify-content-center">
          <div class="col-lg-5">
            <div class="login-register-wraper">

              <!-- Tab Navigation -->
              <ul class="nav nav-tabs nav-tabs-bordered justify-content-center mb-4" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    data-bs-toggle="tab"
                    data-bs-target="#login-register-login-form"
                    type="button"
                    role="tab"
                    aria-selected="true"
                  >
                    <i class="bi bi-box-arrow-in-right me-1"></i>Login
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    data-bs-toggle="tab"
                    data-bs-target="#login-register-registration-form"
                    type="button"
                    role="tab"
                    aria-selected="false"
                  >
                    <i class="bi bi-person-plus me-1"></i>Register
                  </button>
                </li>
              </ul>

              <!-- Tab Content -->
              <div class="tab-content">

                <!-- Login Form -->
                <div
                  class="tab-pane fade show active"
                  id="login-register-login-form"
                  role="tabpanel"
                >
                  <form action="/users/login" method="POST">
                    <div class="mb-4">
                      <label
                        for="login-register-login-email"
                        class="form-label"
                        >Email address</label
                      >
                      <input
                        type="email"
                        name="email"
                        class="form-control"
                        id="login-register-login-email"
                        required
                        value="<%= formData.email || '' %>"
                        placeholder="Enter your Email"
                      />
                    </div>

                    <div class="mb-4">
                      <label
                        for="login-register-login-password"
                        class="form-label"
                        >Password</label
                      >
                      <input
                        type="password"
                        name="password"
                        class="form-control"
                        id="login-register-login-password"
                        placeholder="Enter your password"
                        required
                      />
                    </div>

                    <div
                      class="d-flex justify-content-between align-items-center mb-4"
                    >
                      <div class="form-check">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          id="login-register-remember-me"
                          name="rememberMe"
                        />
                        <label
                          class="form-check-label"
                          for="login-register-remember-me"
                          >Remember me</label
                        >
                      </div>
                      <a href="/users/forgot-password" class="forgot-password"
                        >Forgot Password?</a
                      >
                    </div>

                    <div class="d-grid">
                      <button
                        type="submit"
                        class="btn btn-primary btn-lg"
                      >
                        Login
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Registration Form -->
                <div
                  class="tab-pane fade"
                  id="login-register-registration-form"
                  role="tabpanel"
                >
                  <form action="/users/register" method="POST">
                    <div class="mb-4">
                      <label for="reg-name" class="form-label">Full Name</label>
                      <input
                        type="text"
                        name="name"
                        class="form-control"
                        id="reg-name"
                        required
                        value="<%= formData.name || '' %>"
                        placeholder="Your full name"
                      />
                    </div>

                    <div class="mb-4">
                      <label for="reg-email" class="form-label">Email address</label>
                      <input
                        type="email"
                        name="email"
                        class="form-control"
                        id="reg-email"
                        required
                        value="<%= formData.email || '' %>"
                        placeholder="your.email@example.com"
                      />
                    </div>

                    <div class="mb-4">
                      <label for="reg-password" class="form-label">Password</label>
                      <input
                        type="password"
                        name="password"
                        class="form-control"
                        id="reg-password"
                        required
                        placeholder="Enter your password"
                      />
                    </div>

                    <div class="mb-4">
                      <label
                        for="reg-confirm-password"
                        class="form-label"
                        >Confirm Password</label
                      >
                      <input
                        type="password"
                        name="confirmPassword"
                        class="form-control"
                        id="reg-confirm-password"
                        required
                        placeholder="Re-enter your password"
                      />
                    </div>

                    <div class="form-check mb-4">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="reg-terms"
                        name="terms"
                        required
                      />
                      <label class="form-check-label" for="reg-terms">
                        I agree to
                        <a href="/terms">Terms of Service</a> and
                        <a href="/privacy">Privacy Policy</a>
                      </label>
                    </div>

                    <div class="d-grid">
                      <button
                        type="submit"
                        class="btn btn-primary btn-lg"
                      >
                        Create Account
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast Notification -->
  <div
    class="position-fixed top-0 end-0 p-3"
    style="z-index: 1080"
  >
    <div
      id="liveToast"
      class="toast"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="toast-header">
        <strong
          class="me-auto"
          id="toast-title"
        >
          Notification
        </strong>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="toast"
          aria-label="Close"
        ></button>
      </div>
      <div class="toast-body" id="toast-body">
        <!-- Toast message goes here -->
      </div>
    </div>
  </div>

<%- include('partials/footer') %>

<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/php-email-form/validate.js"></script>
<script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="/assets/vendor/aos/aos.js"></script>
<script src="/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
<script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="/assets/vendor/drift-zoom/Drift.min.js"></script>
<script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>

<script src="/assets/js/main.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Ambil pesan dari variabel EJS
  const successMsg = <%- JSON.stringify(typeof success !== 'undefined' ? success : '') %>;
  const errorMsg = <%- JSON.stringify(typeof error !== 'undefined' ? error : '') %>;
  const redirectToHomepage = <%- JSON.stringify(typeof redirectToHomepage !== 'undefined' ? redirectToHomepage : false) %>;

  // Pastikan window.showToast tersedia dari main.js
  if (typeof window.showToast === 'function') {
    if (successMsg) {
      window.showToast(successMsg, 'success', 1500, () => { // Gunakan callback untuk redirect
        if (redirectToHomepage) {
          window.location.href = '/';
        }
      });
    } else if (errorMsg) {
      window.showToast(errorMsg, 'error');
    }
  } else {
    // Fallback jika showToast belum dimuat atau tidak tersedia
    if (successMsg) {
      alert(successMsg);
      if (redirectToHomepage) {
        window.location.href = '/';
      }
    } else if (errorMsg) {
      alert(errorMsg);
    }
  }

  // Logika untuk tab Login/Register agar tab Registration aktif jika ada error/success dari register
  const registrationFormTabBtn = document.querySelector('button[data-bs-target="#login-register-registration-form"]');
  const loginFormTabBtn = document.querySelector('button[data-bs-target="#login-register-login-form"]');
  const registrationFormTab = document.getElementById('login-register-registration-form');
  const loginFormTab = document.getElementById('login-register-login-form');

  if (errorMsg && (errorMsg.includes("Email already in use") || errorMsg.includes("Password and confirm password do not match") || errorMsg.includes("You must agree to terms and privacy policy") || errorMsg.includes("All fields are required"))) {
      if (registrationFormTabBtn && loginFormTabBtn && registrationFormTab && loginFormTab) {
          // Deactivate login tab
          loginFormTabBtn.classList.remove('active');
          loginFormTab.classList.remove('show', 'active');

          // Activate registration tab
          registrationFormTabBtn.classList.add('active');
          registrationFormTab.classList.add('show', 'active');
      }
  }
});
</script>

</body>
</html>